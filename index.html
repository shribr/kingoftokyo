<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>King of Tokyo</title>
    <!-- Google Fonts for handwritten style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <!-- Modular CSS Structure -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/splash.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/game-areas.css">
    <link rel="stylesheet" href="css/monsters.css">
    <link rel="stylesheet" href="css/dice.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <!-- Left side Polaroids -->
            <div class="polaroids-left">
                <div class="polaroid polaroid-1">
                    <img src="images/characters/king_of_tokyo_gigazaur.png" alt="Gigazaur" />
                    <div class="polaroid-caption">Gigazaur</div>
                </div>
                <div class="polaroid polaroid-2">
                    <img src="images/characters/king_of_tokyo_cyber_bunny.png" alt="Cyber Bunny" />
                    <div class="polaroid-caption">Cyber Bunny</div>
                </div>
                <div class="polaroid polaroid-3">
                    <img src="images/characters/king_of_tokyo_kraken.png" alt="Kraken" />
                    <div class="polaroid-caption">Kraken</div>
                </div>
            </div>
            
            <!-- Main content -->
            <div class="splash-center-content">
                <img src="images/king-of-tokyo-logo.png" alt="King of Tokyo" class="splash-logo-image" />
                <div id="enter-battle-btn" class="splash-subtitle clickable">Enter the battle for Tokyo!</div>
            </div>
            
            <!-- Right side Polaroids -->
            <div class="polaroids-right">
                <div class="polaroid polaroid-4">
                    <img src="images/characters/king_of_tokyo_the_king.png" alt="The King" />
                    <div class="polaroid-caption">The King</div>
                </div>
                <div class="polaroid polaroid-5">
                    <img src="images/characters/king_of_tokyo_meka_dragon.png" alt="Meka Dragon" />
                    <div class="polaroid-caption">Meka Dragon</div>
                </div>
                <div class="polaroid polaroid-6">
                    <img src="images/characters/king_of_tokyo_alienoid.png" alt="Alienoid" />
                    <div class="polaroid-caption">Alienoid</div>
                </div>
            </div>
        </div>
        
        <!-- City Skyline Container -->
        <div class="city-skyline-container">
            <!-- Manhattan-style Connected Skyline SVG -->
            <svg class="skyline" viewBox="0 0 1400 300" xmlns="http://www.w3.org/2000/svg">
                <!-- Single continuous path for connected skyline - no bottom border -->
                <path d="M0,180 L100,180 L100,80 L180,80 L180,140 L280,140 L280,200 L350,200 L350,40 L420,40 L420,120 L520,120 L520,170 L600,170 L600,90 L680,90 L680,220 L780,220 L780,160 L860,160 L860,70 L940,70 L940,190 L1040,190 L1040,130 L1120,130 L1120,100 L1200,100 L1200,210 L1300,210 L1300,160 L1400,160" 
                      fill="none" 
                      stroke="rgba(255, 255, 255, 0.35)" 
                      stroke-width="2"/>
                
                <!-- Sparse windows for "late night office" effect -->
                <rect x="70" y="120" width="8" height="10" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="140" y="160" width="8" height="10" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="380" y="70" width="6" height="8" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="580" y="130" width="8" height="10" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="820" y="100" width="6" height="8" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="980" y="170" width="8" height="10" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="1080" y="150" width="6" height="8" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
                <rect x="1250" y="180" width="8" height="10" fill="rgba(255, 255, 255, 0.25)" opacity="0.7"/>
            </svg>
        </div>
    </div>

    <div id="game-container">
        <!-- Header -->
        <header class="game-header">
            <h1 data-text="KING OF TOKYO!">KING OF TOKYO!</h1>
            <div id="active-player-name" class="active-player-name"></div>
            <span id="rolls-left" class="rolls-indicator">Rolls left: 3</span>
            <div class="game-info">
            </div>
        </header>

        <!-- Main Game Area -->
        <main class="game-board">
            <!-- Tokyo Area -->
            <div class="tokyo-area">
                <div class="tokyo-bay">
                    <h3>Tokyo Bay</h3>
                    <div id="tokyo-bay-monster" class="monster-slot"></div>
                </div>
                <div class="tokyo-city">
                    <h3>Tokyo City</h3>
                    <div id="tokyo-city-monster" class="monster-slot"></div>
                </div>
                <!-- Round Indicator -->
                <div class="round-indicator-container">
                    <span class="round-label">Round</span>
                    <div id="round-indicator" class="round-indicator">
                        <span id="round-counter">1</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Players Area (moved outside game-container for autonomy) -->
    <div class="players-area collapsible-panel" id="monsters-panel">
        <h3 class="panel-header" id="monsters-header">
            <span class="header-text">
                Monsters
                <span class="toggle-arrow">></span>
            </span>
        </h3>
        <div id="players-container" class="panel-content"></div>
    </div>

    <!-- Bottom UI Table: 3-row layout for notifications, dice/actions, and toolbar -->
    <div id="bottom-ui-table" class="bottom-ui-table">
        <!-- Row 1: CPU Notifications -->
        <div class="ui-row notification-row">
            <div id="cpu-action-notification" class="cpu-action-notification"></div>
        </div>
        
        <!-- Row 2: Dice Area (left) and Action Menu (right) -->
        <div class="ui-row action-row">
            <div class="dice-area draggable hidden-until-game-start" id="dice-area">
                <div id="dice-container" class="dice-container"></div>
            </div>
            
            <div class="action-menu draggable" id="action-menu">
                <button id="roll-dice" class="action-button btn primary">Roll Dice</button>
                <button id="keep-dice" class="action-button btn secondary" disabled>Keep Dice</button>
                <!-- <button id="buy-cards" class="action-button btn tertiary">Buy Power Cards</button> -->
                <button id="end-turn" class="action-button btn quaternary">End Turn</button>
            </div>
        </div>
        
        <!-- Row 3: Game Toolbar (anchor) -->
        <div class="ui-row toolbar-row">
            <div id="game-toolbar" class="game-toolbar">
                <button id="exit-game-btn" class="toolbar-btn" title="Exit to Main Menu">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z"/>
                        </svg>
                    </span>
                </button>
                <button id="pause-game-btn" class="toolbar-btn" title="Pause Game">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,19H18V5H14M6,19H10V5H6V19Z"/>
                        </svg>
                    </span>
                </button>
                <button id="instructions-btn" class="toolbar-btn" title="Instructions">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 2C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2H6ZM6 4H13V9H18V20H6V4ZM8 12V14H16V12H8ZM8 16V18H13V16H8Z"/>
                        </svg>
                    </span>
                </button>
                <button id="settings-btn" class="toolbar-btn" title="Settings">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11.03L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11.03C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                        </svg>
                    </span>
                </button>
                <button id="game-log-btn" class="toolbar-btn" title="Game Log">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                    </span>
                </button>
                <button id="storage-mgmt-btn" class="toolbar-btn" title="Storage Management">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,3C7.58,3 4,4.79 4,7C4,9.21 7.58,11 12,11C16.42,11 20,9.21 20,7C20,4.79 16.42,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14Z"/>
                        </svg>
                    </span>
                </button>
                <button id="save-game-toolbar-btn" class="toolbar-btn" title="Save Game">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
                        </svg>
                    </span>
                </button>
                <button id="reset-positions-btn" class="toolbar-btn" title="Reset Layout Positions">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M18,11H13L14.5,9.5C14.1,9.1 13.6,8.8 13,8.5C12.4,8.2 11.7,8 11,8C9.3,8 7.8,8.9 7.2,10.3C6.6,11.7 7.1,13.4 8.5,14C9.9,14.6 11.6,14.1 12.2,12.7H14.2C13.7,15.9 10.7,18.3 7.5,17.8C4.3,17.3 1.9,14.3 2.4,11.1C2.9,7.9 5.9,5.5 9.1,6C10.6,6.2 12,7 12.9,8.2L14.5,6.5V11H18Z"/>
                        </svg>
                    </span>
                </button>
                <button id="dark-mode-btn" class="toolbar-btn" title="Toggle Dark Mode">
                    <span class="toolbar-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.4 6.35,17.41C9.37,20.43 14,20.54 17.33,17.97Z"/>
                        </svg>
                    </span>
                </button>
                <!-- AI mode button removed; AI is the single mode -->
            </div>
        </div>

    </div> <!-- End bottom-ui-table -->

    <!-- Game Pause Overlay -->
    <div id="game-pause-overlay" class="game-pause-overlay hidden">
        <div class="pause-message">GAME PAUSED</div>
    </div>

    <!-- Power Cards Area (moved outside game-container for autonomy) -->
    <div class="cards-area collapsible-panel" id="power-cards-panel">
        <h3 class="panel-header" id="power-cards-header">
            <span class="header-text">
                <span class="toggle-arrow"><</span>
                Power Cards
            </span>
        </h3>
        <div id="available-cards" class="cards-container panel-content"></div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-btn" id="close-game-over">×</button>
            <h2>Game Over!</h2>
            <div id="winner-announcement"></div>
            <button id="new-game" class="btn primary">New Game</button>
        </div>
    </div>

    <!-- Decision Modal -->
    <div id="decision-modal" class="modal hidden">
        <div class="modal-content decision-modal">
            <div class="decision-header">
                <h2 id="decision-title">Decision Required</h2>
                <div id="decision-context" class="decision-context"></div>
            </div>
            <div class="decision-body">
                <p id="decision-message">You need to make a decision!</p>
                <div class="decision-monster" id="decision-monster"></div>
            </div>
            <div class="decision-actions">
                <button id="decision-option-1" class="btn decision-btn primary">Option 1</button>
                <button id="decision-option-2" class="btn decision-btn secondary">Option 2</button>
            </div>
        </div>
    </div>

    <!-- Game Setup Modal -->
    <div id="setup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header-with-settings">
                <h2>Monster Selection</h2>
                <div id="setup-settings-icon" class="settings-gear-icon" title="Open Settings">⚙️</div>
            </div>
            <div class="setup-form">
            <div class="setup-header">
                <div class="spacer"></div>
                <button id="monster-profiles-btn" class="btn secondary setup-side-btn" title="View and customize monster personalities">
                    Monster Profiles
                </button>
                
                <div class="player-count-dropdown" id="player-count-dropdown">
                    <div class="dropdown-selected" id="dropdown-selected">
                        4 Players
                        <span class="dropdown-arrow">▼</span>
                    </div>
                    <div class="dropdown-options" id="dropdown-options">
                        <div class="dropdown-option" data-value="2">2 Players</div>
                        <div class="dropdown-option" data-value="3">3 Players</div>
                        <div class="dropdown-option" data-value="4">4 Players</div>
                        <div class="dropdown-option" data-value="5">5 Players</div>
                        <div class="dropdown-option" data-value="6">6 Players</div>
                    </div>
                </div>
                
                <button id="random-selection-btn" class="btn secondary setup-side-btn" title="Auto-assign random monsters">
                    Random Monster Selection
                </button>
                <div class="spacer"></div>
            </div>                    <div id="monster-selection">
                <div class="selection-container">
                    <div class="monster-cards-section">
                        <div class="monster-grid" id="monster-grid"></div>
                    </div>
                    <div class="player-tiles-section">
                        <div class="player-tiles-grid" id="player-tiles-grid">
                            <!-- Player tiles will be dynamically generated -->
                        </div>
                        <div id="reset-monsters" class="reset-text">🔄 Reset Monsters</div>
                    </div>
                </div>
            </div>
            
            <button id="start-game" class="btn primary">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Game Log Modal -->
    <div id="game-log-modal" class="modal hidden">
        <div class="modal-content game-log-content">
            <div class="modal-header">
                <h2>Game Log</h2>
                <button class="close-btn" id="close-game-log">×</button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="log-tabs">
                <button class="tab-btn active" data-tab="game-flow">📝 <span class="tab-label"></span>Game Flow</span></button>
                <button class="tab-btn" data-tab="ai-logic">🧠 <span class="tab-label">AI Logic Flow</span></button>
            </div>
            
            <div class="game-log-container">
                <!-- Game Flow Tab -->
                <div id="game-flow-tab" class="tab-content active">
                    <div class="game-log-entries">
                        <h3>📝 Game Events</h3>
                        <div id="game-log-content">
                            <!-- Log entries will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- AI Logic Flow Tab -->
                <div id="ai-logic-tab" class="tab-content">
                    <div class="game-log-entries">
                        <h3>🧠 AI Decision Logic</h3>
                        <div id="ai-log-content">
                            <!-- AI decision logs will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="game-log-actions">
                <button id="scroll-to-top-btn" class="game-btn secondary large">↑ Top</button>
                <button id="export-logs-btn" class="game-btn secondary large">📄 Export Logs</button>
                <button id="clear-log-btn" class="game-btn secondary large">✕ Clear Log</button>
                <button id="scroll-to-bottom-btn" class="game-btn secondary large">↓ Bottom</button>
            </div>
        </div>
    </div>

    <!-- Storage Management Modal -->
    <div id="storage-mgmt-modal" class="modal hidden">
        <div class="modal-content storage-mgmt-content">
            <div class="modal-header">
                <button class="info-btn" id="storage-info-btn" title="About Storage">i</button>
                <h2>Storage Management</h2>
                <button class="close-btn" id="close-storage-mgmt">×</button>
            </div>
            <div class="storage-mgmt-container">
                <div class="storage-info-section">
                    <h3>📊 Storage Statistics</h3>
                    <div class="storage-stats" id="storage-stats">
                        <!-- Storage statistics will be populated here -->
                    </div>
                </div>
                
                <div class="storage-actions-section">
                    <h3>🛠️ Storage Actions</h3>
                    <div class="storage-controls">
                        <button id="save-game-btn">
                            <span class="btn-icon">💾</span>
                            Save Game Now
                        </button>
                        <button id="export-game-btn">
                            <span class="btn-icon">📤</span>
                            Export Game Data
                        </button>
                        <button id="clear-storage-btn">
                            <span class="btn-icon">🗑️</span>
                            Clear All Storage
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About Storage Side Panel -->
        <div class="storage-about-panel hidden" id="storage-about-panel">
            <div class="storage-about-content">
                <div class="storage-about-header">
                    <div class="storage-about-title">
                        <button class="info-btn small">i</button>
                        <h3>About Storage</h3>
                    </div>
                    <button class="close-btn" id="close-storage-about">×</button>
                </div>
                <div class="storage-help-text">
                    <p>Your game data is automatically saved to your browser's storage. This includes:</p>
                    <ul>
                        <li>Complete game state (players, scores, cards, Tokyo positions)</li>
                        <li>Full game log history with hierarchical organization</li>
                        <li>Automatic compression to save space</li>
                        <li>Memory management to prevent slowdowns</li>
                    </ul>
                    <p><strong>Note:</strong> Clearing browser data will remove saved games.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
        <!-- Instructions Modal -->
    <div id="instructions-modal" class="modal instructions-modal hidden">
        <div class="modal-content">
            <button class="close-btn" id="close-instructions">×</button>
            <div class="instructions-header">
                <h1 class="instructions-title">KING OF TOKYO</h1>
            </div>
            <div class="instructions-content">
                <!-- Backstory Section -->
                <div class="instructions-section">
                    <h2>🌆 THE LEGEND OF TOKYO 🌆</h2>
                    <div class="backstory-text">
                        In the year 2087, a series of mysterious energy rifts opened across the globe, bringing forth colossal monsters from parallel dimensions. Each creature possessed incredible powers and an insatiable hunger for energy crystals that could only be found in major metropolitan areas. Tokyo, with its massive energy grid and towering skyscrapers, became the ultimate prize.
                    </div>
                    <div class="backstory-text">
                        What started as random destruction soon evolved into an epic tournament. The monsters discovered that by defeating opponents and claiming Tokyo as their territory, they could absorb the city's cosmic energy and grow even more powerful. Now, these legendary beasts battle for supremacy in the ultimate kaiju showdown!
                    </div>
                    
                    <h3>🦾 Meet the Monsters 🦾</h3>
                    <div class="monster-profiles">
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_gigazaur.png" alt="Gigazaur" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>Gigazaur</h4>
                                <p>The ancient king of reptiles, awakened from a million-year slumber. This massive dinosaur combines prehistoric fury with modern rage. Known for his devastating tail swipes and earth-shaking roar that can shatter windows across three city blocks.</p>
                            </div>
                        </div>
                        
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_cyber_bunny.png" alt="Cyber Bunny" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>Cyber Bunny</h4>
                                <p>A lab experiment gone adorably wrong. This cybernetically enhanced rabbit gained sentience and giant size after exposure to quantum carrots. Don't let the cute appearance fool you - those hydraulic ears can punch through concrete!</p>
                            </div>
                        </div>
                        
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_kraken.png" alt="Kraken" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>Kraken</h4>
                                <p>Rising from the deepest ocean trenches, this tentacled terror brings the fury of the seven seas to land. Each of his eight arms can operate independently, making him a master of multi-tasking destruction.</p>
                            </div>
                        </div>
                        
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_the_king.png" alt="The King" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>The King</h4>
                                <p>The original giant ape, now with a serious attitude problem. After decades of captivity in Hollywood, he's back and ready to show these newcomers who the real king of monsters is. His building-climbing skills are unmatched.</p>
                            </div>
                        </div>
                        
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_meka_dragon.png" alt="Meka Dragon" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>Meka Dragon</h4>
                                <p>A fusion of ancient magic and cutting-edge technology. This mechanical dragon was created by Tokyo's top scientists to defend the city, but its AI decided that ruling it would be more fun. Breathes both fire and laser beams.</p>
                            </div>
                        </div>
                        
                        <div class="monster-profile">
                            <img src="images/characters/king_of_tokyo_alienoid.png" alt="Alienoid" class="monster-headshot">
                            <div class="monster-bio">
                                <h4>Alienoid</h4>
                                <p>An interdimensional visitor with unclear motives. Some say it's here to study Earth's monsters, others believe it's scouting for an invasion. Either way, its psychic powers and shape-shifting abilities make it a formidable opponent.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game Overview -->
                <div class="instructions-section">
                    <h2>🎯 HOW TO DOMINATE TOKYO 🎯</h2>
                    <div class="game-overview">
                        <div class="game-feature">
                            <h4>🎲 Roll for Power</h4>
                            <div class="feature-image">🎲</div>
                            <p>Roll six custom dice up to three times per turn. Each die face gives you different powers - attack enemies, gain energy, heal damage, or earn victory points!</p>
                        </div>
                        
                        <div class="game-feature">
                            <h4>🏙️ Control Tokyo</h4>
                            <div class="feature-image">🏙️</div>
                            <p>Enter Tokyo to gain victory points each turn, but beware - you can't heal while in the city, and every monster outside will be gunning for you!</p>
                        </div>
                        
                        <div class="game-feature">
                            <h4>⚡ Buy Power Cards</h4>
                            <div class="feature-image">⚡</div>
                            <p>Spend energy cubes to purchase powerful cards that give you permanent abilities, bonus attacks, or special powers to dominate your opponents!</p>
                        </div>
                        
                        <div class="game-feature">
                            <h4>💀 Eliminate Rivals</h4>
                            <div class="feature-image">💀</div>
                            <p>Reduce enemy monsters to 0 health to eliminate them from the game. Last monster standing automatically wins the ultimate prize!</p>
                        </div>
                    </div>
                </div>

                <!-- Dice Reference -->
                <div class="instructions-section">
                    <h2>🎲 DICE FACES EXPLAINED 🎲</h2>
                    <div class="dice-grid">
                        <div class="dice-face-info">
                            <span class="dice-symbol">👊</span>
                            <h5>Attack</h5>
                            <p>Deal damage to monsters in or outside Tokyo</p>
                        </div>
                        <div class="dice-face-info">
                            <span class="dice-symbol">⚡</span>
                            <h5>Energy</h5>
                            <p>Gain energy cubes to buy power cards</p>
                        </div>
                        <div class="dice-face-info">
                            <span class="dice-symbol">❤️</span>
                            <h5>Heart</h5>
                            <p>Heal damage (only if outside Tokyo)</p>
                        </div>
                        <div class="dice-face-info">
                            <span class="dice-symbol">1️⃣</span>
                            <h5>Numbers</h5>
                            <p>Collect 3+ of same number for victory points</p>
                        </div>
                        <div class="dice-face-info">
                            <span class="dice-symbol">2️⃣</span>
                            <h5>Numbers</h5>
                            <p>3=1VP, 4=2VP, 5=3VP, 6=4VP</p>
                        </div>
                        <div class="dice-face-info">
                            <span class="dice-symbol">3️⃣</span>
                            <h5>Numbers</h5>
                            <p>Roll more of same number for bonus points</p>
                        </div>
                    </div>
                </div>

                <!-- Victory Conditions -->
                <div class="instructions-section">
                    <h2>🏆 PATHS TO VICTORY 🏆</h2>
                    <div class="victory-paths">
                        <div class="victory-path">
                            <h4>Victory Points</h4>
                            <ul>
                                <li>Reach 20 victory points first</li>
                                <li>Gain points by controlling Tokyo</li>
                                <li>Roll matching numbers (3+ of same)</li>
                                <li>Buy powerful scoring cards</li>
                                <li>Some cards give bonus points</li>
                            </ul>
                        </div>
                        
                        <div class="victory-path">
                            <h4>Last Monster Standing</h4>
                            <ul>
                                <li>Eliminate all other monsters</li>
                                <li>Deal damage with attack dice</li>
                                <li>Use power cards for extra damage</li>
                                <li>Force enemies out of Tokyo</li>
                                <li>Prevent others from healing</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Quick Reference -->
                <div class="instructions-section">
                    <h2>⚡ QUICK REFERENCE ⚡</h2>
                    <div class="quick-reference">
                        <div class="quick-ref-item">
                            <h5>Turn Sequence</h5>
                            <p>1. Roll dice (up to 3 times)<br>2. Resolve dice effects<br>3. Buy power cards<br>4. End turn</p>
                        </div>
                        <div class="quick-ref-item">
                            <h5>Tokyo Rules</h5>
                            <p>Enter: +1 VP immediately<br>Stay: +2 VP each turn start<br>Can't heal while inside<br>Must leave if taking damage</p>
                        </div>
                        <div class="quick-ref-item">
                            <h5>Attack Resolution</h5>
                            <p>In Tokyo: Attack all outside<br>Outside: Attack monster in Tokyo<br>No Tokyo monster: No attacks<br>Defender chooses to stay/leave</p>
                        </div>
                        <div class="quick-ref-item">
                            <h5>Power Cards</h5>
                            <p>Cost energy cubes to buy<br>Permanent abilities<br>Some give instant effects<br>Discard when instructed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monster Profiles Modal -->
    <div id="monster-profiles-modal" class="modal hidden">
        <div class="modal-content monster-profiles-content">
            <div class="modal-header">
                <h2>👹 MONSTER PROFILES 👹</h2>
                <button class="btn close-btn" id="close-monster-profiles">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profiles-intro">
                    <p>Each monster has a unique personality that affects their CPU behavior. Customize their traits below:</p>
                </div>
                <div class="monster-profiles-grid" id="monster-profiles-grid">
                    <!-- Monster profiles will be dynamically generated here -->
                </div>
                <div class="profiles-actions">
                    <button class="btn secondary" id="reset-profiles-btn">🔄 Reset to Defaults</button>
                    <button class="btn-tokyo-base" id="save-profiles-btn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Individual Monster Profile Modal Template -->
    <div id="individual-monster-profile-template" class="modal hidden">
        <div class="modal-content individual-monster-profile-content">
            <div class="modal-header">
                <h2 class="monster-profile-title">👹 MONSTER PROFILE 👹</h2>
                <button class="btn close-btn monster-profile-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="individual-monster-profile-container">
                    <!-- Individual monster profile card will be cloned and inserted here -->
                </div>
                <div class="individual-profile-actions">
                    <button class="btn-tokyo-base monster-profile-save">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div id="exit-confirmation-modal" class="modal hidden">
        <div class="modal-content exit-confirmation-content">
            <div class="modal-header">
                <h2>🚪 Exit to Splash Screen</h2>
                <button class="close-btn" id="close-exit-confirmation">×</button>
            </div>
            <div class="modal-body">
                <div class="exit-warning">
                    <div class="warning-icon">⚠️</div>
                    <div class="warning-message">
                        <p><strong>Are you sure you want to exit the current game?</strong></p>
                        <p>Your current progress will be automatically saved, but you'll return to the main menu.</p>
                    </div>
                </div>
                <div class="exit-actions">
                    <button class="exit-button exit-cancel" id="exit-cancel-btn">Cancel</button>
                    <button class="exit-button exit-confirm" id="exit-confirm-btn">Exit to Menu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="settings-modal hidden">
        <div class="settings-content">
            <div class="settings-header">
                <h2>⚙️ Game Settings</h2>
                <button class="close-settings" id="close-settings">×</button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h3>🤖 CPU Settings</h3>
                    <div class="settings-option">
                        <label>CPU Decision Speed</label>
                        <p>Adjust how long CPU players take to make decisions:</p>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="cpu-speed" value="fast" id="speed-fast">
                                <span>⚡ Fast (1-2s)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cpu-speed" value="medium" id="speed-medium" checked>
                                <span>🧠 Medium (2-4s)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cpu-speed" value="slow" id="speed-slow">
                                <span>🐌 Slow (3-6s)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-option">
                        <label>
                            <input type="checkbox" id="thought-bubbles-toggle" checked>
                            💭 Show CPU thought bubbles
                        </label>
                    </div>
                    <div class="settings-option indented" id="thought-bubble-advanced">
                        <label for="thought-bubble-position-select">Thought Bubble Position</label>
                        <!-- Hidden native select for accessibility/fallback -->
                        <select id="thought-bubble-position-select" class="visually-hidden" aria-hidden="true" tabindex="-1">
                            <option value="player">From Player</option>
                            <option value="center">Centered</option>
                        </select>
                        <div class="custom-dropdown thought-bubble-position-dropdown" id="thought-bubble-position-dropdown">
                            <div class="dropdown-selected" id="thought-bubble-position-selected">
                                From Player
                                <span class="dropdown-arrow">▼</span>
                            </div>
                            <div class="dropdown-options" id="thought-bubble-position-options">
                                <div class="dropdown-option" data-value="player">From Player</div>
                                <div class="dropdown-option" data-value="center">Centered</div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-option indented">
                        <label>Thought Bubble Duration</label>
                        <p class="setting-help small-note">Adjust how long bubbles remain visible (multiplier).</p>
                        <input type="range" id="thought-bubble-duration" min="0.5" max="2.0" step="0.1" value="1" aria-label="Thought bubble duration multiplier">
                        <div><span id="thought-bubble-duration-value">1.0x</span></div>
                    </div>
                    <div class="settings-option indented">
                        <label>
                            <input type="checkbox" id="thought-bubble-dim" checked>
                            Dim background behind bubbles
                        </label>
                    </div>
                    
                    <!-- AI mode settings removed — AI is the single mode -->
                    
                    <div class="settings-option">
                        <label>
                            <input type="checkbox" id="dark-mode-toggle">
                            🌙 Dark Mode
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>👹 Monster Configuration</h3>
                    <div class="settings-option">
                        <label>Select Active Monsters</label>
                        <p>Choose which monsters appear in Monster Selection:</p>
                        <div class="monster-checkboxes" id="monster-checkboxes">
                            <!-- Monster checkboxes will be dynamically generated here -->
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="settings-button" id="save-settings">Save Settings</button>
                    <button class="settings-button" id="reset-settings">Reset to Default</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/gameStorage.js"></script>
    <script>console.log('✅ gameStorage.js loaded, gameStorage available:', typeof gameStorage !== 'undefined');</script>
    
    <script src="js/monsters.js"></script>
    <script>console.log('✅ monsters.js loaded, MONSTERS available:', typeof MONSTERS !== 'undefined');</script>
    
    <script src="js/cards.js"></script>
    <script>console.log('✅ cards.js loaded, POWER_CARDS available:', typeof POWER_CARDS !== 'undefined');</script>
    
    <script src="js/dice.js"></script>
    <script>console.log('✅ dice.js loaded');</script>
    
    <script src="js/ui-utilities.js"></script>
    <script>console.log('✅ ui-utilities.js loaded, UIUtilities available:', typeof UIUtilities !== 'undefined');</script>
    
    <script src="js/ai-decisions.js"></script>
    <script>console.log('✅ ai-decisions.js loaded, AIDecisionEngine available:', typeof AIDecisionEngine !== 'undefined');</script>
    
    <script src="js/ui/setup.js"></script>
    <script>console.log('✅ setup.js loaded, SetupManager available:', typeof SetupManager !== 'undefined');</script>
    
    <script src="js/game.js"></script>
    <script>console.log('✅ game.js loaded, KingOfTokyoGame available:', typeof KingOfTokyoGame !== 'undefined');</script>
    
    <!-- AI Reasoning Info Modal -->
    <div id="ai-reasoning-info-modal" class="modal hidden">
        <div class="modal-content ai-reasoning-info-content">
            <div class="modal-header">
                <h3>AI Reasoning Details</h3>
                <button class="close-btn" id="close-ai-reasoning-info">×</button>
            </div>
            <div class="ai-reasoning-info-body" id="ai-reasoning-info-body">
                <!-- Detailed reasoning content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Roll-off Modal -->
    <div id="roll-off-modal" class="modal hidden">
        <div class="modal-content roll-off-content">
            <div class="modal-header">
                <h2 class="rolloff-title">🎲 Roll for First Player</h2>
            </div>
            <div class="roll-off-body">
                <div id="rolloff-commentary" class="rolloff-commentary">
                    Let's see who will take the first turn...
                </div>
                <div class="rolloff-scoreboard">
                    <table id="rolloff-table" class="rolloff-table">
                        <thead>
                            <tr>
                                <th class="player-column">Player</th>
                                <th class="dice-column">Roll Results</th>
                                <th class="attacks-column">Attacks</th>
                            </tr>
                        </thead>
                        <tbody id="rolloff-table-body">
                            <!-- Rows will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="rolloff-actions">
                    <button id="rolloff-roll-btn" class="btn primary hidden" onclick="window.gameUI?.handleRolloffRoll()">
                        🎲 Roll Dice
                    </button>
                    <a id="rolloff-skip-link" class="rolloff-skip-link" href="#" onclick="window.gameUI?.skipRolloff(); return false;" title="Clicking this link skips the dice &quot;roll off&quot; and selects a player at random to go first instead.">
                        skip <span class="info-icon">i</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/main.js"></script>
</body>
</html>
