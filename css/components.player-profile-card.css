/* components.player-profile-card.css (legacy parity version) */

.cmp-player-profile-card { position:relative; width:260px; background:linear-gradient(135deg,var(--ppc-accent,#2d3436) 0%, #1b1f20 100%); border:3px solid #000; border-radius:4px; padding:12px 14px 16px; font-family:'Bangers',cursive; letter-spacing:1px; color:#fff; box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; /* Lower value = shift visible area UP to show more top of image */ --ppc-avatar-pos-y:18%; flex-shrink: 0; }
.cmp-player-profile-card + .cmp-player-profile-card { margin-top:18px; }
.cmp-player-profile-card.is-active { outline:3px solid #ffd400; outline-offset:3px; }

/* Header */
.cmp-player-profile-card .ppc-header { display:flex; align-items:flex-start; margin:0 0 14px; position:relative; }
.cmp-player-profile-card .ppc-avatar { width:58px; height:58px; border:3px solid #000; border-radius:50%; background:#fff center var(--ppc-avatar-pos-y)/cover no-repeat; box-shadow:2px 2px 0 #000; margin-right:10px; cursor:pointer; transition:transform 0.2s ease, box-shadow 0.2s ease; }
.cmp-player-profile-card .ppc-avatar { aspect-ratio:1 / 1; object-fit:cover; flex:0 0 58px; }
/* Anti-warp reinforcement: any scaling container must not distort avatar */
.cmp-player-profile-card .ppc-avatar img, .cmp-player-profile-card .ppc-avatar picture, .cmp-player-profile-card .ppc-avatar canvas { width:100%; height:100%; object-fit:cover; border-radius:50%; display:block; }
/* Reset accidental width/height overrides that break circle (legacy cascades) */
.cmp-player-profile-card .ppc-avatar[style*="width:"][style*="height:"] { aspect-ratio:1/1; }
/* Mini / panel variants still enforce 1:1 */
.cmp-monsters-panel .cmp-player-profile-card .ppc-avatar,
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-avatar { aspect-ratio:1/1; }
.cmp-player-profile-card .ppc-avatar:hover { transform:scale(1.05); box-shadow:3px 3px 0 #000, 0 0 0 2px #ffd400; }
.cmp-player-profile-card .ppc-meta { flex:1; display:flex; flex-direction:column; align-items:flex-start; }

/* Expand/collapse toggle for list view */
.cmp-player-profile-card .ppc-expand-toggle {
  display: none; /* Hidden by default, shown only in list view */
  position: absolute;
  top: 4px;
  right: 4px;
  width: 32px;
  height: 32px;
  cursor: pointer;
  z-index: 100;
  background: transparent !important;
  border: none !important;
  border-radius: 4px !important;
  padding: 4px;
  transition: opacity 0.2s ease;
  opacity: 0.8;
}

/* In list view, show the arrow positioned in top-right corner */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card {
  position: relative; /* Enable absolute positioning for arrow */
}

.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-expand-toggle {
  display: block !important;
}

.cmp-player-profile-card .ppc-expand-toggle:hover {
  opacity: 1;
}

.cmp-player-profile-card .ppc-expand-icon {
  display: block;
  transition: transform 0.2s ease;
  color: #fff;
  width: 16px;
  height: 10px;
  filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.8));
}

/* Standard header margin in list view */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-header {
  margin-bottom: 12px;
  padding-right: 20px; /* Reduced from 40px - just enough room for arrow */
}

/* Shift player name more to the left in list view */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-name {
  margin-left: -4px; /* Shift name to the left */
  padding-right: 4px; /* Reduced from 8px - minimal buffer */
  font-size: 24px; /* Smaller than default 30px */
  line-height: 1.1; /* Slightly tighter line height */
}

/* Make status indicators (CPU, etc.) slightly smaller in list view */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-status-line {
  font-size: 11px; /* Smaller than default 12px */
}



/* Ensure stats stay horizontal in list view */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-stats {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;
}

.cmp-player-profile-card .ppc-name { font-size:30px; line-height:1; margin:0 0 6px; text-shadow:-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000,2px 2px 0 #000; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%; position:relative; display:inline-flex; flex-wrap:wrap; align-items:flex-start; }
.cmp-player-profile-card .ppc-name small { font-size:14px; opacity:.65; margin-left:6px; letter-spacing:0; }

/* Tokyo status indicator */
.cmp-player-profile-card .ppc-tokyo { font-size:12px; color:#ff6b35; font-weight:bold; text-shadow:1px 1px 0 #000; opacity:0; transition:opacity 0.3s ease; }
.cmp-player-profile-card .ppc-tokyo.is-in { opacity:1; }
.cmp-player-profile-card[data-in-tokyo="true"] { border-color:#ff6b35; box-shadow:4px 4px 0 #000,0 0 0 2px #ff6b35 inset, 0 0 12px rgba(255,107,53,0.4); }
.cmp-player-profile-card[data-in-tokyo="true"] .ppc-avatar { border-color:#ff6b35; }
.cmp-player-profile-card .ppc-status-line { display:flex; gap:8px; font-size:12px; align-items:center; }
.cmp-player-profile-card .ppc-active-indicator { color:#ffd400; font-size:18px; }
.cmp-player-profile-card .ppc-tokyo-indicator { 
  display:inline-flex; 
  margin-top:4px; 
  line-height:1; 
  /* Removed max-height to allow natural height with new 6px vertical padding */
  overflow:hidden; 
  align-self:flex-start; 
  font-weight:600;
  font-family:'Bangers',cursive;
  text-transform:none; 
  position:relative; 
  flex:0 0 auto; 
  min-height:0 !important;
  width:auto !important;
  max-width:100%;
 }
.cmp-player-profile-card .ppc-status-line { position:relative; }
.cmp-player-profile-card .ppc-tokyo-indicator.is-in {
  background:#0b435c;
  color:#fff;
  padding:6px 12px 6px;
  font-size:clamp(10px, 2.2vw, 14px);
  border:3px solid #000;
  box-shadow:2px 2px 0 #000;
  letter-spacing:.5px;
  white-space:nowrap;
  line-height:1;
  pointer-events:none;
  max-width:100%;
  box-sizing:border-box;
  flex:0 0 auto;
  height:auto;
}

/* Attribute-based badge (defensive reset) */
.cmp-player-profile-card [data-tokyo-badge] {
  min-height:0 !important;
  width:auto !important;
  display:inline-flex;
}

/* Stats row */
.cmp-player-profile-card .ppc-stats { display:flex; gap:10px; margin:0 0 12px; }
.cmp-player-profile-card .ppc-stat { flex:1; background:#fafafa; color:#111; border:3px solid #000; text-align:center; padding:8px 4px 6px; box-shadow:2px 2px 0 #000; font-family:'Bangers',cursive; position:relative; }
.cmp-player-profile-card .ppc-stat .label { display:block; font-size:12px; letter-spacing:.5px; color:#222; margin:0 0 2px; }
.cmp-player-profile-card .ppc-stat .value { font-size:28px; color:var(--ppc-accent-text,#ffd400); text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000; line-height:1; }

/* Owned cards lane */
.cmp-player-profile-card .ppc-owned-cards { background:#1c2123; border:3px solid #000; padding:8px 8px 10px; box-shadow:2px 2px 0 #000; }
.cmp-player-profile-card .ppc-owned-cards-label { font-size:14px; color:#ffd400; margin:0 0 4px; }
.cmp-player-profile-card .ppc-owned-cards-strip { display:flex; gap:5px; flex-wrap:wrap; }
.cmp-player-profile-card .ppc-card-mini { background:#333; color:#fff; font-size:12px; padding:3px 6px 4px; border:2px solid #000; border-radius:2px; max-width:80px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; box-shadow:1px 1px 0 #000; }

/* Health block */
.cmp-player-profile-card .ppc-health-block { background:#fff; border:3px solid #000; box-shadow:2px 2px 0 #000; padding:6px 10px 10px; margin-top:10px; }
.cmp-player-profile-card .ppc-health-label { font-size:20px; color:#000; margin:0 0 6px; text-shadow:none; }
.cmp-player-profile-card .ppc-health-bar { position:relative; background:#222; border:3px solid #000; height:20px; overflow:hidden; }
.cmp-player-profile-card .ppc-health-bar .fill { position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg,#3ad65c,#129b37); transition:width .35s ease; }
.cmp-player-profile-card .ppc-health-bar[data-low="true"] .fill { background:linear-gradient(90deg,#ff4d3d,#b30000); }

/* Attack pulse animation */
.cmp-player-profile-card.attack-pulse { animation:ppcPulse 2s ease; }

/* Active Dock Entrance Animation */
.cmp-player-profile-card[data-in-active-dock="true"] {
  animation: activeDockIn 0.55s cubic-bezier(.25,.9,.35,1.15);
}
@keyframes activeDockIn {
  0% { transform: translate(40px,-30px) scale(.65) rotate(4deg); opacity:0; filter:brightness(1.3); }
  55% { transform: translate(-6px,4px) scale(1.04) rotate(-2deg); opacity:1; }
  75% { transform: translate(3px,-2px) scale(.98) rotate(1deg); }
  100% { transform: translate(0,0) scale(1) rotate(0deg); opacity:1; filter:brightness(1); }
}

.cmp-player-profile-card.active-dock-reflow[data-in-active-dock="true"] { animation: activeDockIn 0.55s cubic-bezier(.25,.9,.35,1.15); }
@keyframes ppcPulse { 0%,100% { box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; } 50% { box-shadow:0 0 0 3px #ffd400,0 0 12px 4px #ffdb4d; } }

/* VP flash animation */
.cmp-player-profile-card .ppc-stat.vp.vp-flash { animation:vpFlash 1.5s ease; }
@keyframes vpFlash { 0%,100% { box-shadow:2px 2px 0 #000; } 20%,40%,60%,80% { box-shadow:0 0 0 3px #ffd400,0 0 12px 4px #ffdb4d; transform:scale(1.1); } }

/* Energy flash animation */
.cmp-player-profile-card .ppc-stat.energy.energy-flash { animation:energyFlash 1.5s ease; }
@keyframes energyFlash { 0%,100% { box-shadow:2px 2px 0 #000; } 20%,40%,60%,80% { box-shadow:0 0 0 3px #00ff41,0 0 12px 4px #00ff41; transform:scale(1.1); } }

/* Health flash animation */
.cmp-player-profile-card .ppc-health-bar.health-flash { animation:healthFlash 1.5s ease; }
@keyframes healthFlash { 0%,100% { box-shadow:none; } 20%,40%,60%,80% { box-shadow:0 0 0 3px #3ad65c,0 0 12px 4px #3ad65c; transform:scale(1.02); } }

/* Hover effect minimal to preserve board readability */
.cmp-player-profile-card:hover { transform:translateY(-2px); box-shadow:6px 6px 0 #000,0 0 0 2px #222 inset; }

/* Responsive downscale */
@media (max-width:900px) { 
  .cmp-player-profile-card { width:220px; padding:10px 12px 14px; }
  #active-player-card-slot .cmp-player-profile-card {
    width: 220px !important;
    min-width: 220px !important;
    max-width: 220px !important;
    flex-shrink: 0;
  }
}

/* Strong mobile shrink overrides (must appear after base + generic responsive to win cascade) */
@media (max-width:760px), (pointer: coarse) {
  .cmp-monsters-panel .cmp-player-profile-card.cmp-player-profile-card { 
    width:100% !important; max-width:100% !important; padding:6px 10px 8px !important; border-width:2px !important; box-shadow:3px 3px 0 #000,0 0 0 2px #222 inset !important; 
  }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-header { margin:0 0 8px !important; align-items:center !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-avatar { width:40px !important; height:40px !important; border-width:2px !important; margin-right:8px !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-name { font-size:18px !important; line-height:1.05 !important; margin:0 0 2px !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] { padding:9px 11px 11px !important; box-shadow:0 3px 12px rgba(0,0,0,0.5),0 0 0 2px var(--ppc-accent,#333) !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-avatar { width:50px !important; height:50px !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stats { gap:6px !important; margin:0 0 8px !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stat { padding:6px 2px 4px !important; border-width:2px !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stat .value { font-size:22px !important; }
  .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-owned-cards { padding:6px 6px 8px !important; border-width:2px !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-card-mini { font-size:11px !important; max-width:70px !important; }
  /* Active dock scaling assist: reduce base width so scale calc ends smaller */
  #active-player-card-slot .cmp-player-profile-card[data-in-active-dock="true"] { width:200px !important; }

  /* Ultra-compact adjustments for very narrow widths */
  @media (max-width:520px) {
    .cmp-monsters-panel .cmp-player-profile-card.cmp-player-profile-card { padding:5px 8px 6px !important; }
    .cmp-monsters-panel .cmp-player-profile-card .ppc-avatar { width:36px !important; height:36px !important; }
    .cmp-monsters-panel .cmp-player-profile-card .ppc-name { font-size:16px !important; }
    .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] { padding:7px 9px 9px !important; }
    .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-avatar { width:44px !important; height:44px !important; }
    .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stats { gap:5px !important; }
    .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stat { padding:5px 2px 4px !important; }
    .cmp-monsters-panel .cmp-player-profile-card[data-expanded="true"] .ppc-stat .value { font-size:20px !important; }
    .cmp-monsters-panel .cmp-player-profile-card .ppc-card-mini { font-size:10px !important; max-width:62px !important; }
  }

  /* Additional deep shrink for non-expanded list view cards */
  .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) { padding:5px 8px 6px !important; }
  .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) .ppc-avatar { width:34px !important; height:34px !important; }
  .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) .ppc-name { font-size:15px !important; }
  @media (max-width:520px) {
    .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) { padding:4px 7px 5px !important; }
    .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) .ppc-avatar { width:32px !important; height:32px !important; }
    .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) .ppc-name { font-size:14px !important; }
  }
}

/* ------------------------------------------------------------------ */
/* Legacy stack & rotation parity for non-active cards (visual haphazard pile)
 * Applies only within the monsters panel container. Active card floats clean.
 */
.cmp-monsters-panel .mp-player-cards { position:relative; display:flex; flex-direction:column; }
.cmp-monsters-panel.is-stacked .mp-player-cards { perspective:1400px; perspective-origin:50% 30%; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card { transition:transform .45s cubic-bezier(.25,.46,.45,.94), margin .35s ease; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card.is-active { position:relative; z-index:3100; transform:none; margin-top:0; }
/* Base style for non-active stacked cards */
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active) {
	position:relative;
	z-index:3000; /* below active */
	transform:perspective(800px) rotateX(1deg) rotateY(-0.5deg) rotateZ(.25deg);
	margin-bottom:0;
}
/* Overlap stack: pull subsequent cards upward */
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active) + .cmp-player-profile-card:not(.is-active) { margin-top:-90px; }

/* Individual variance (mirrors legacy nth-child transforms) */
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(1):not(.is-active) { transform:perspective(800px) rotateX(.8deg) rotateY(-.3deg) rotateZ(-2.2deg); }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(2):not(.is-active) { transform:perspective(800px) rotateX(1.2deg) rotateY(.4deg) rotateZ(2.6deg); margin-left:-6px; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(3):not(.is-active) { transform:perspective(800px) rotateX(.9deg) rotateY(-.7deg) rotateZ(-2.1deg); margin-left:6px; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(4):not(.is-active) { transform:perspective(800px) rotateX(1.1deg) rotateY(.2deg) rotateZ(2.4deg); margin-left:-5px; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(5):not(.is-active) { transform:perspective(800px) rotateX(.7deg) rotateY(-.4deg) rotateZ(-2deg); margin-left:5px; }
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(6):not(.is-active) { transform:perspective(800px) rotateX(1.3deg) rotateY(.6deg) rotateZ(2.3deg); margin-left:-4px; }

/* Responsive: reduce overlap on narrow screens */
@media (max-width:900px) {
	.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active) + .cmp-player-profile-card:not(.is-active) { margin-top:-60px; }
}

/* Linear layout fallback when stacking disabled */
.cmp-monsters-panel:not(.is-stacked) .mp-player-cards { gap:14px; }
.cmp-monsters-panel:not(.is-stacked) .mp-player-cards .cmp-player-profile-card { margin:0; transform:none; }

/* New layout modes (stacked | condensed | list) ----------------------------- */
/* Stacked (existing) already handled via .is-stacked with strong overlap (-90px) */
/* Condensed: lighter overlap & reduced rotation for better readability */
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active) + .cmp-player-profile-card:not(.is-active) { margin-top:-55px; }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(1):not(.is-active) { transform:perspective(800px) rotateX(.4deg) rotateY(-.15deg) rotateZ(-1.3deg); }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(2):not(.is-active) { transform:perspective(800px) rotateX(.6deg) rotateY(.2deg) rotateZ(1.4deg); margin-left:-4px; }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(3):not(.is-active) { transform:perspective(800px) rotateX(.5deg) rotateY(-.3deg) rotateZ(-1.2deg); margin-left:4px; }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(4):not(.is-active) { transform:perspective(800px) rotateX(.6deg) rotateY(.1deg) rotateZ(1.2deg); margin-left:-3px; }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(5):not(.is-active) { transform:perspective(800px) rotateX(.5deg) rotateY(-.2deg) rotateZ(-1.1deg); margin-left:3px; }
.cmp-monsters-panel[data-card-layout="condensed"].is-stacked .mp-player-cards .cmp-player-profile-card:nth-child(6):not(.is-active) { transform:perspective(800px) rotateX(.7deg) rotateY(.3deg) rotateZ(1.1deg); margin-left:-2px; }

/* List: show only header section (hide stats and health) */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .mp-player-cards .cmp-player-profile-card { 
  margin:0 0 8px; 
  transform:none; 
  position:relative;
}
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .mp-player-cards .cmp-player-profile-card:last-child { margin-bottom:0; }

/* Hide stats and health sections in list view by default */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-stats,
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-health-block,
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card .ppc-owned-cards {
  display: none;
}

/* Show stats and health when expanded in list view */
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card[data-expanded] .ppc-stats,
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card[data-expanded] .ppc-health-block,
.cmp-monsters-panel:not(.is-stacked):not(.is-tiled) .cmp-player-profile-card[data-expanded] .ppc-owned-cards {
  display: block;
}

/* Legacy list layout compatibility */
.cmp-monsters-panel[data-card-layout="list"] .mp-player-cards .cmp-player-profile-card { margin:0 0 18px; transform:none; position:relative; }
.cmp-monsters-panel[data-card-layout="list"] .mp-player-cards .cmp-player-profile-card:last-child { margin-bottom:0; }
.cmp-monsters-panel[data-card-layout="list"] { --ppc-stack-mode:list; }

/* Floating active card (relocated outside panel) */
/* Active card slot: act as a centering container for the docked PPC */
#active-player-card-slot { position:absolute; pointer-events:none; top:40%; left:50%; z-index:6700; transition: left .45s cubic-bezier(.25,.46,.45,.94), top .45s cubic-bezier(.25,.46,.45,.94); margin:0; padding:0; transform:translate(-50%, -50%); display:block; }
#active-player-card-slot .cmp-player-profile-card { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); transform-origin:center center; pointer-events:auto; }

/* Contained mode: when the slot is appended inside the dedicated active player tile, remove viewport-centered offsets */
[data-active-player-slot] > #active-player-card-slot { top:50%; left:50%; width:100%; height:100%; position:absolute; }
[data-active-player-slot] > #active-player-card-slot .cmp-player-profile-card { position:absolute; top:50%; left:50%; /* Removed max-width and max-height constraints to allow free scaling */ }
/* Ensure no unintended scaling persists on slot itself (scaling now applied to card element) */
[data-active-player-slot] > #active-player-card-slot { transform:translate(-50%, -50%); }

/* Mobile: allow intrinsic width and avoid forced scale that produced vertical stretching */
@media (max-width: 760px), (pointer: coarse) {
  #active-player-card-slot .cmp-player-profile-card {
    width:auto !important;
    min-width:0 !important;
    max-width:100% !important;
    transform:translate(-50%, -50%) !important; /* scale applied dynamically in JS */
  }
  #active-player-card-slot .cmp-player-profile-card .ppc-header { margin-top:4px !important; }
  /* Ensure stats remain a single horizontal row when visible */
  .cmp-monsters-panel .cmp-player-profile-card .ppc-stats { flex-wrap:nowrap !important; white-space:nowrap !important; gap:6px !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-stat { padding:6px 2px 4px !important; border-width:2px !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-stat .label { font-size:11px !important; }
  .cmp-monsters-panel .cmp-player-profile-card .ppc-stat .value { font-size:22px !important; }
  /* Deep shrink for non-expanded list view: hide stats unless expanded to save vertical space */
  .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card:not([data-expanded="true"]) .ppc-stats { display:none !important; }
  .cmp-monsters-panel[data-card-layout="list"] .cmp-player-profile-card[data-expanded="true"] .ppc-stats { display:flex !important; }
  @media (max-width:520px) {
    .cmp-monsters-panel .cmp-player-profile-card .ppc-stats { gap:4px !important; }
    .cmp-monsters-panel .cmp-player-profile-card .ppc-stat { padding:5px 2px 4px !important; }
    .cmp-monsters-panel .cmp-player-profile-card .ppc-stat .value { font-size:20px !important; }
  }
}
#active-player-card-slot[data-active-card-dock] { min-width:260px; /* removed min-height constraint to allow card scaling */ position:absolute; }

/* Mini active dock variation */
/* Mini dock dimensions and centering */
#active-player-card-slot[data-mini="true"] { width:200px; min-width:200px; min-height:140px; }
#active-player-card-slot[data-mini="true"]::before { display:none; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card { width:220px; transform:translate(-50%, -50%) scale(.82); transform-origin:center center; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card.turn-pulse { animation:none; }
/* Placeholder outline when empty */
#active-player-card-slot[data-mini="true"]:empty {
	border:2px dashed rgba(255,212,0,0.55);
	border-radius:10px;
	box-shadow:0 0 0 2px rgba(0,200,255,0.35), 0 0 12px -2px rgba(0,200,255,0.45);
	background:repeating-linear-gradient(45deg, rgba(255,212,0,0.08) 0 10px, rgba(255,212,0,0) 10px 20px);
}

/* Dock pop animation (scale & slight upward float) applied when transitioning */
.cmp-player-profile-card[data-transitioning] { transform-origin:center; }

/* Non-active hover parity (legacy tilt/glow) */
/* Base transform-origin so pivot looks like it lifts from the stack edge */
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active) { transform-origin:bottom center; }

/* Pivot-out hover (stacked mode) – more dramatic legacy style */
.cmp-monsters-panel.is-stacked .mp-player-cards .cmp-player-profile-card:not(.is-active):hover {
	/* neutralize original slight random tilt on hover but keep a hint of personality */
	transform:perspective(1000px) rotateX(-10deg) rotateY(0deg) rotateZ(0deg) translateY(-24px) scale(1.05);
	box-shadow:8px 10px 0 #000,0 0 0 2px #222 inset,0 14px 28px rgba(0,0,0,.65);
	z-index:3050;
	margin-bottom:28px; /* create breathing room under the pivoted card */
}

/* Subtle lift hover when NOT stacked (linear layout) */
.cmp-monsters-panel:not(.is-stacked) .mp-player-cards .cmp-player-profile-card:not(.is-active):hover {
	transform:translateY(-6px) scale(1.02);
	box-shadow:6px 6px 0 #000,0 0 0 2px #222 inset,0 8px 18px rgba(0,0,0,.45);
	z-index:3050;
}

/* Tokyo badge accent variant */
.cmp-player-profile-card .ppc-tokyo-indicator.is-in { background:linear-gradient(135deg,var(--ppc-accent,#0b435c) 0%, #062733 100%); }

/* Transition when docking/undocking */
.cmp-player-profile-card[data-transitioning] { opacity:.0; transform:scale(.9); transition:opacity .25s ease, transform .3s ease; }
.cmp-player-profile-card[data-transitioning].in-place { opacity:1; transform:scale(1); }
/* Smooth active-dock shrink animation */
.cmp-player-profile-card.docking-active {
  will-change: transform;
  transition: transform 260ms cubic-bezier(.25,.6,.35,1);
}
/* Slight spring settle after docking */
.cmp-player-profile-card.docking-active.settled {
  transition: transform 320ms cubic-bezier(.25,1.4,.35,1);
}

/* Active turn pulse animation */
@keyframes ppcActivePulse {
	0% { transform:scale(1) translateZ(0); box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; }
	35% { transform:scale(1.065) translateZ(0); box-shadow:6px 6px 0 #000,0 0 0 3px #222 inset,0 0 18px rgba(255,212,0,.35); }
	60% { transform:scale(1.03) translateZ(0); box-shadow:5px 5px 0 #000,0 0 0 2px #222 inset,0 0 12px rgba(255,212,0,.25); }
	100% { transform:scale(1) translateZ(0); box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; }
}
.cmp-player-profile-card.is-active.turn-pulse { animation:ppcActivePulse 900ms cubic-bezier(.34,.11,.34,1.32); }
/* Tokyo entry animation */
.cmp-player-profile-card[data-entered-tokyo] { animation:tokyoEnter 1200ms ease; }
@keyframes tokyoEnter { 0% { transform:scale(.85) rotate(-3deg); box-shadow:0 0 0 0 rgba(255,207,51,0); } 40% { transform:scale(1.08) rotate(1deg); box-shadow:0 0 0 6px rgba(255,207,51,.45); } 70% { transform:scale(.97) rotate(-1deg); box-shadow:0 0 0 3px rgba(255,207,51,.25); } 100% { transform:scale(1) rotate(0); box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; } }
/* Non-active cards should not show move cursor */
.cmp-player-profile-card[data-draggable="false"] { cursor:default; }
/* When docked to arena, the SLOT carries the scale; keep the card centered only. */
[data-active-card-dock] .cmp-player-profile-card { transform:translate(-50%, -50%); transform-origin: center center; }
/* VP / Energy / Health gain pulses */
.cmp-player-profile-card[data-vp-gain] .ppc-stat[data-kind="vp"],
.cmp-player-profile-card[data-energy-gain] .ppc-stat[data-kind="energy"],
.cmp-player-profile-card[data-health-gain] .ppc-health-block { animation:resourceGain 900ms ease; }
@keyframes resourceGain { 0% { filter:brightness(1); transform:translateY(0); } 25% { filter:brightness(1.35); transform:translateY(-4px); } 55% { filter:brightness(1.15); transform:translateY(1px); } 100% { filter:brightness(1); transform:translateY(0); } }

/* Subtle glow when docking into active slot */
@keyframes ppcDockGlow {
  0% { box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset,0 0 0 0 rgba(255,255,255,0); }
  35% { box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset,0 0 18px 6px rgba(255,255,255,.55); }
  65% { box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset,0 0 12px 3px rgba(255,255,255,.35); }
  100% { box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset,0 0 0 0 rgba(255,255,255,0); }
}
.cmp-player-profile-card.dock-glow { animation:ppcDockGlow 1000ms ease-out; }

/* Placeholder fade when active card leaves stack */
.ppc-fade-placeholder { position:fixed; background:linear-gradient(135deg,#2d3436,#1b1f20); border:3px solid #000; border-radius:4px; box-shadow:4px 4px 0 #000,0 0 0 2px #222 inset; pointer-events:none; z-index:2950; animation:ppcSlotFade .5s ease forwards; }
@keyframes ppcSlotFade { from { opacity:1; transform:scale(1); } to { opacity:0; transform:scale(.92); } }

/* CPU indicator styling (improved readability)
 * Reuse monster name visual language: bold white with heavy black outline.
 * Added a subtle translucent pill background & inner border for contrast on dark gradients.
 * Scoped tightly to player profile card to avoid bleeding into other CPU labels.
 */
.cmp-player-profile-card .ppc-name .ppc-cpu {
  display:inline-block;
  font-size:20px;
  line-height:1;
  font-weight:900;
  letter-spacing:1px;
  font-family:'Bangers',cursive;
  color:#fff;
  text-shadow:-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000,2px 2px 0 #000;
  margin-left:8px;
  position:relative;
  top:-1px;
  background:transparent;
  border:none;
  padding:0 4px;
  white-space:normal; /* allow wrapping */
}
/* When space is constrained (mobile panels / narrow widths) allow CPU label to drop below name to prevent overflow */
@media (max-width: 760px), (pointer: coarse) {
  .cmp-player-profile-card .ppc-name { white-space:normal; overflow:visible; text-overflow:clip; }
  .cmp-player-profile-card .ppc-name .ppc-cpu { display:block; width:100%; margin-left:0; margin-top:4px; top:0; padding:0; }
}

/* Safety: if container width becomes too small anywhere (e.g., panel constraints), allow wrap globally */
@supports (overflow-wrap: anywhere) {
  .cmp-player-profile-card .ppc-name.wrap-cpu { white-space:normal; overflow:visible; text-overflow:clip; }
  .cmp-player-profile-card .ppc-name.wrap-cpu .ppc-cpu { display:block; width:100%; margin-left:0; margin-top:4px; top:0; padding:0; }
}

/* High-contrast mode or bright accent cards could optionally opt-in to a brighter CPU pill */
.cmp-player-profile-card[data-bright-accent="true"] .ppc-name .ppc-cpu {
	background:linear-gradient(135deg,rgba(255,212,0,.85),rgba(255,180,0,.85));
	color:#000;
	text-shadow:1px 1px 0 #fff; /* lighter outline when on bright pill */
}

/* Avatar with mapped image */
.cmp-player-profile-card .ppc-avatar[data-avatar-src] { background-size:cover; background-position:center var(--ppc-avatar-pos-y); box-shadow:0 0 0 3px #000, 0 0 10px rgba(0,0,0,.6); }

/* Mobile flip capability stays available but without forcing square or name-only styles; the monsters panel CSS governs layout. */
@media (max-width: 760px), (pointer: coarse) {
	.cmp-player-profile-card { backface-visibility:hidden; transform-style:preserve-3d; }
	.cmp-player-profile-card [data-owned-cards] { display:block; }
	.cmp-player-profile-card[data-flipped] .ppc-stats,
	.cmp-player-profile-card[data-flipped] [data-health-block] { display:none; }
	.cmp-player-profile-card:not([data-flipped]) [data-owned-cards] { display:none; }
}

/* Mini avatar-only cues when docked (keep header visible, compress body) */
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card .ppc-stats { display:none; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card [data-owned-cards][data-owned-cards] { display:none; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card .ppc-health-block { display:none; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card .ppc-name { display:none; }

/* --- Mini Tokyo Occupant Variant -------------------------------------------------
 * The arena inserts a cloned player profile card with class .cmp-player-profile-card--mini
 * when a player occupies Tokyo (see arena.component.js renderOccupant). Without sizing
 * rules this clone renders full height, producing a tall green rectangle. These rules
 * compress the card, hide non-essential blocks (health + owned cards), and prevent
 * overflow so the Tokyo slot shows a concise badge-like card.
 */
.cmp-player-profile-card.cmp-player-profile-card--mini { 
  --mini-scale: .78;
  width: 200px; 
  max-width:200px; 
  padding:8px 10px 10px; 
  position:relative; 
  border:2px solid var(--ppc-accent,#2d3436);
  background:linear-gradient(135deg,var(--ppc-accent,#2d3436) 0%, rgba(27,31,32,0.9) 100%);
  border-radius:6px; 
  box-shadow:2px 2px 0 #000; 
  overflow:hidden; 
  font-size:12px; 
}
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-expand-toggle { display:none !important; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-owned-cards,
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-health-block { display:none !important; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats { margin-top:4px; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats .ppc-stat { padding:2px 4px; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-name { font-size:18px; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-status-line { margin-top:2px; }
.cmp-player-profile-card.cmp-player-profile-card--mini[data-in-tokyo] .ppc-tokyo-indicator { 
  display:inline-block; 
  padding:2px 6px; 
  font-size:11px; 
  border:2px solid #000; 
  background:linear-gradient(135deg,#0b435c,#062733); 
  border-radius:4px; 
  letter-spacing:1px; 
}
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-avatar { 
  width:42px; 
  height:42px; 
  border-radius:50%; 
  background-size:cover; 
  background-position:center; 
  flex-shrink:0; 
}
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-header { 
  display:flex; 
  align-items:center; 
  gap:10px; 
  margin:0; 
  padding:0; 
}
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-meta { flex:1; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-name { margin:0; line-height:1.1; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats { display:flex; gap:6px; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats .ppc-stat { 
  background:#fff; 
  border:2px solid #000; 
  box-shadow:2px 2px 0 #000; 
  font-size:11px; 
  min-width:50px; 
}
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats .ppc-stat .label { font-size:9px; letter-spacing:.5px; }
.cmp-player-profile-card.cmp-player-profile-card--mini .ppc-stats .ppc-stat .value { font-size:14px; }

/* Ensure Tokyo slot wrapper doesn't stretch because of line-height or hidden content */
.tokyo-occupant { display:flex; align-items:center; justify-content:center; padding:2px 0; }
.tokyo-occupant > .cmp-player-profile-card--mini { margin:0 !important; }
/* Prevent smushing of mini player cards when inside Tokyo City/Bay */
.tokyo-occupant .cmp-player-profile-card--mini { flex:0 0 auto; width:auto; max-width:190px; }
.tokyo-occupant .cmp-player-profile-card--mini .ppc-header { flex-wrap:nowrap; }
.tokyo-occupant .cmp-player-profile-card--mini .ppc-avatar { width:42px; height:42px; object-fit:contain; }

#active-player-card-slot[data-mini="true"] .cmp-player-profile-card .ppc-meta { display:none; }
#active-player-card-slot[data-mini="true"] .cmp-player-profile-card .ppc-avatar { width:58px; height:58px; }

/* Prefer a neutral white arrival glow with ripple when docking into the active slot */
#active-player-card-slot .cmp-player-profile-card.is-active.dock-glow.cmp-player-profile-card { animation: ppcDockGlow 900ms ease-out; position:relative; }
#active-player-card-slot .cmp-player-profile-card.is-active.dock-glow::after {
	content:""; position:absolute; inset:-2px; border-radius:8px; pointer-events:none;
	box-shadow:0 0 0 0 rgba(255,255,255,.6); animation:ppcRipple 1000ms ease-out forwards;
}
@keyframes ppcRipple { 0% { box-shadow:0 0 0 0 rgba(255,255,255,.6); opacity:1; } 45% { box-shadow:0 0 0 14px rgba(255,255,255,.25); opacity:.9; } 100% { box-shadow:0 0 0 26px rgba(255,255,255,0); opacity:0; } }

/* Mobile floor: ensure player/monster name never smaller than CPU label (>=20px) */
@media (max-width: 760px), (pointer: coarse) {
  .cmp-player-profile-card .ppc-name { font-size:20px !important; }
}

