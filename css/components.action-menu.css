/* components.action-menu.css
 * Extracted from legacy .action-menu + button cluster styling.
 */
 :root {
  --action-menu-bg: linear-gradient(145deg,#2a2d31,#181a1c 65%); /* lighter legacy-inspired */
  --action-menu-border: 3px solid #000;
  --action-menu-inner-border: 0 0 0 2px #353a40 inset;
  --action-menu-radius: 6px;
  --action-menu-gap: 3px; /* tighter vertical gap */
  --action-menu-padding: 6px 12px 8px; /* more compact */
  --action-menu-title-color: var(--accent-monsters,#ffcf33);
  --action-menu-shadow: 4px 4px 0 #000, 0 0 0 2px #222 inset;
}

.cmp-action-menu {
  position:fixed;
  top:110px; /* desktop default: near top */
  right:48px; /* desktop default */
  display:flex;
  flex-direction:column;
  flex-wrap:nowrap;
  gap:var(--action-menu-gap);
  background:var(--action-menu-bg);
  padding:6px 20px 8px; /* restored horizontal padding (20px) */
  border:var(--action-menu-border);
  border-radius:var(--action-menu-radius);
  box-shadow:var(--action-menu-shadow);
  z-index:6000; /* below peek modal (7000) but above other panels */
  font-family:'Bangers',cursive;
  letter-spacing:.5px;
  width:260px; /* unify width */
  max-width:260px;
  min-width:260px;
  align-items:stretch;
  filter:none;
  -webkit-backdrop-filter:none;
  backdrop-filter:none;
  /* Added horizontal breathing room */
  margin-left:40px;
  margin-right:40px;
}

/* Mobile / touch adjustments */
@media (max-width: 760px), (pointer: coarse) {
  .cmp-action-menu { 
    top: 120px; 
    right: 20px; 
    left: auto; 
    width: 85vw; 
    max-width: 85vw; 
    min-width: 0; 
    padding: 8px 10px 10px; 
    gap: 6px; 
  }
  body[data-action-menu-open] .cmp-action-menu { 
    display: flex !important; 
  }
  .cmp-action-menu .am-content { flex-direction: row; flex-wrap: wrap; }
  .cmp-action-menu button { flex: 1 1 auto; min-width: 42%; }
  .cmp-action-menu .power-cards-menu-container { flex: 1 1 100%; }
}

/* Drag grip redesign (collapsed: only dots visible; expands on hover) */
.cmp-action-menu .am-header-row { display:flex; align-items:center; gap:4px; position:relative; overflow:visible; }
.cmp-action-menu .am-drag-grip.am-grip-left {
  position:absolute;
  top:8px; /* align near top inside header */
  left:-10px; /* slight protrusion so dots are visible */
  width:18px; /* collapsed width just enough for 2 columns of dots */
  padding:4px 4px 6px;
  background:transparent; /* appear hidden behind menu */
  border:0; border-right:none; border-radius:6px 0 0 6px;
  display:grid;
  grid-template-columns:repeat(2,6px);
  grid-auto-rows:6px;
  gap:4px 3px;
  box-shadow:none;
  cursor:grab;
  z-index:1;
  transition:left .28s ease, width .28s ease, padding .28s ease, background .25s ease, box-shadow .25s ease;
}
.cmp-action-menu .am-drag-grip.am-grip-left .grip-dot { 
  width:6px; height:6px; background:#d5d5d5; border-radius:50%; box-shadow:0 0 0 1px rgba(0,0,0,.4);
}
.cmp-action-menu .am-drag-grip.am-grip-left:hover,
.cmp-action-menu .am-drag-grip.am-grip-left:focus {
  left:-44px; /* slide further out */
  width:46px; /* expanded tab width */
  padding:8px 8px 10px 10px;
  background:linear-gradient(135deg,#52565c,#232527);
  border:2px solid #000; border-right:none;
  box-shadow:2px 2px 0 #000, 0 0 0 1px #222 inset;
}
.cmp-action-menu .am-drag-grip.am-grip-left:active { cursor:grabbing; }

/* When draggable and has transform applied, allow free positioning */
.cmp-action-menu[data-draggable="true"][style*="transform"] {
  top: 0;
  left: 0;
  right: auto;
  bottom: auto;
}
.app-toolbar, .game-toolbar, [data-toolbar] { margin-bottom:12px; }
.cmp-action-menu .am-label { 
  display:flex !important; 
  align-items: center;
  justify-content: space-between;
  position:static; 
  margin:0; /* Remove bottom margin since flex gap handles spacing */
  background:transparent !important; 
  color:#fff; 
  padding:2px 6px 4px; 
  font-size:24px; 
  line-height:1; 
  border:none !important; 
  box-shadow:none !important; 
  letter-spacing:1.2px; 
  text-shadow:-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000,2px 2px 0 #000;
  border-radius: 0 !important;
  outline: none !important;
  width: 100%;
}

/* Collapse/Expand Toggle Container */
.cmp-action-menu .am-collapse-toggle {
  /* Reset all possible inherited button styles */
  all: unset;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  cursor: pointer;
  color: #fff !important;
  opacity: 1;
  transition: opacity 0.2s ease, transform 0.1s ease;
  background: none !important;
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  border-radius: 0 !important;
  width: auto;
  height: 20px;
  position: relative;
  padding: 2px;
}

.cmp-action-menu .am-collapse-toggle:hover {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
  color: #fff !important;
}

.cmp-action-menu .am-collapse-toggle:hover .arrow-up,
.cmp-action-menu .am-collapse-toggle:hover .arrow-down {
  transform: translateY(-50%) scale(1.1);
}

.cmp-action-menu .am-collapse-toggle:focus {
  outline: none;
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}

.cmp-action-menu .am-collapse-toggle:active {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}

.cmp-action-menu .am-collapse-toggle .arrow-up,
.cmp-action-menu .am-collapse-toggle .arrow-down {
  font-size: 14px;
  font-weight: bold;
  color: #fff !important;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
  transition: opacity 0.2s ease;
  position: absolute;
  right: 2px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none; /* Ensure clicks go to parent button */
}

.cmp-action-menu .am-collapse-toggle .arrow-up {
  opacity: 0; /* Hidden by default (collapsed state) */
}

.cmp-action-menu .am-collapse-toggle .arrow-down {
  opacity: 1; /* Visible by default (expanded state) */
}

.cmp-action-menu .am-collapse-toggle svg {
  width: 16px;
  height: 16px;
  fill: currentColor;
  border: none !important;
  box-shadow: none !important;
  background: none !important;
  outline: none !important;
}

/* Content Container Collapse Styles */
.cmp-action-menu .am-content {
  transition: max-height 0.3s ease, opacity 0.2s ease;
  overflow: hidden;
  margin-top: 2px; /* tiny separation for readability */
  padding-top: 0;
  display: flex;
  flex-direction: column;
  gap: var(--action-menu-gap);
  transform-origin: top; /* grow upward when expanding */
}

.cmp-action-menu .am-content[data-collapsed="true"] {
  max-height: 0px !important;
  opacity: 0 !important;
  overflow: hidden !important;
}

.cmp-action-menu .am-content[data-collapsed="false"] {
  max-height: 500px !important;
  opacity: 1 !important;
  overflow: visible !important;
}

.cmp-action-menu[data-layout="horizontal"] { flex-direction:row; flex-wrap:wrap; align-items:flex-start; }
.cmp-action-menu[data-layout="horizontal"] .am-label { margin-bottom:6px; }

/* Power Cards Menu Styles */
.power-cards-menu-container {
  position: relative;
  width: auto;
}

.power-cards-btn {
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  width: auto;
  background: linear-gradient(135deg, #2c5234, #1a3d20) !important;
  border-color: #4a7c59 !important;
}

.power-cards-btn:hover:not(:disabled) {
  background: linear-gradient(135deg, #345a3b, #1f4524) !important;
}

.power-cards-btn .arrow-left,
.power-cards-btn .arrow-right {
  font-size: 14px;
  font-weight: bold;
  color: #fff;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
  transition: opacity 0.2s ease;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
  position: absolute;
}

.power-cards-btn .arrow-left {
  left: 8px;
  opacity: 0; /* Hidden by default (desktop) */
}

.power-cards-btn .arrow-right {
  right: 8px;
  opacity: 1; /* Visible by default (desktop) */
}

.power-cards-btn .btn-text {
  flex: 1;
  text-align: center;
  position: relative;
  z-index: 1;
}

.power-cards-submenu {
  position: absolute;
  top: 0;
  z-index: 6700;
  background: var(--action-menu-bg);
  border: var(--action-menu-border);
  border-radius: var(--action-menu-radius);
  box-shadow: var(--action-menu-shadow);
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 200px;
  opacity: 0;
  transform: scale(0.95);
  transition: opacity 0.2s ease, transform 0.2s ease;
  pointer-events: none;
}

.power-cards-submenu:not([hidden]) {
  pointer-events: auto;
}

.power-cards-submenu:not([hidden]) {
  opacity: 1;
  transform: scale(1);
}

.power-cards-submenu.submenu-left {
  right: 100%;
  margin-right: 8px;
}

.power-cards-submenu.submenu-right {
  left: 100%;
  margin-left: 8px;
}

.power-cards-submenu button {
  white-space: nowrap;
  font-size: 14px;
  padding: 6px 12px;
}

/* Deck illumination on power cards button hover */
.power-cards-btn:hover ~ .power-cards-submenu,
.power-cards-btn:hover {
  animation: deckIlluminate 0.3s ease-out;
}

@keyframes deckIlluminate {
  0% { box-shadow: var(--action-menu-shadow); }
  50% { box-shadow: var(--action-menu-shadow), 0 0 15px #4a7c59; }
  100% { box-shadow: var(--action-menu-shadow); }
}

/* Trigger deck illumination in power cards panel */
.power-cards-btn:hover {
  --deck-illuminate: true;
}

/* All action menu buttons - consistent styling with power card font */
.cmp-action-menu button {
  font-family: 'Bangers', cursive !important;
  font-size: 18px !important;
  letter-spacing: 0.75px !important;
  color: #fff !important;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000 !important;
  min-height: 48px !important;
  padding: 8px 12px !important;
  border: 2px solid #000 !important;
  border-radius: 6px !important;
  box-shadow: 2px 2px 0 #000, 0 0 0 2px #222 inset !important;
  transition: all 0.2s ease !important;
}

/* End Turn Button - Red when enabled */
.cmp-action-menu [data-action="end"]:not(:disabled) {
  background: linear-gradient(145deg, #8b2c2c, #5c1a1a) !important;
  border-color: #a64545 !important;
  color: #fff !important;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000 !important;
}

.cmp-action-menu [data-action="end"]:not(:disabled):hover {
  background: linear-gradient(145deg, #9d3333, #661f1f) !important;
  color: #fff !important;
}
.cmp-action-menu[data-layout="vertical"] { flex-direction:column; flex-wrap:nowrap; width:260px; }
.cmp-action-menu[data-layout="vertical"] button { width:100%; max-width:100%; }
.cmp-action-menu { row-gap:12px; }
/* Base reset for buttons (we'll color per action) */
.cmp-action-menu button {
  --btn-bg-muted:#c5c5c5;
  border:3px solid #000;
  box-shadow:3px 3px 0 #000,0 0 0 2px #222 inset;
  font-family:'Bangers',cursive;
  letter-spacing:.5px;
  padding:8px 16px 10px;
  font-size:18px;
  line-height:1;
  cursor:pointer;
  position:relative;
  color:#fff;
  text-shadow:-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000,2px 2px 0 #000;
  transition:transform .18s cubic-bezier(.25,.46,.45,.94), box-shadow .18s ease, filter .2s ease, background .25s ease;
}

/* ROLL = Yellow */
.cmp-action-menu button[data-action="roll"] {
  background:linear-gradient(135deg,#ffe066,#ffb400);
  color:#222;
  text-shadow:none;
  border-color:#111;
}
.cmp-action-menu button[data-action="roll"]:not(:disabled):hover { filter:brightness(1.08); transform:translate(-2px,-3px); }
.cmp-action-menu button[data-action="roll"]:not(:disabled):active { transform:translate(0,0); }

/* KEEP ALL = Blue */
.cmp-action-menu button[data-action="keep"] {
  background:linear-gradient(135deg,#1f6ed4,#084c99);
  border-color:#052d57;
}
.cmp-action-menu button[data-action="keep"]:not(:disabled):hover { background:linear-gradient(135deg,#2c7fe6,#0a5bab); }

/* ACCEPT DICE RESULTS = Orange */
.cmp-action-menu button[data-action="accept-dice"] {
  background:linear-gradient(135deg,#ffb347,#ff7a18);
  border-color:#b35400;
}
.cmp-action-menu button[data-action="accept-dice"]:not(:disabled):hover { background:linear-gradient(135deg,#ffc162,#ff8a32); }

/* POWER CARDS = Green (button already has custom class, keep override) */
.cmp-action-menu button[data-action="power-cards"] {
  background:linear-gradient(135deg,#2c5234,#1a3d20) !important;
  border-color:#4a7c59 !important;
}
.cmp-action-menu button[data-action="power-cards"]:not(:disabled):hover { background:linear-gradient(135deg,#345a3b,#1f4524) !important; }

/* MY CARDS + FLUSH inside submenu (inherit smaller variant) */
.cmp-action-menu button[data-action="show-my-cards"],
.cmp-action-menu button[data-action="flush"] { font-size:16px; }

/* FLUSH keep gold accent */
.cmp-action-menu button[data-action="flush"] { background:linear-gradient(135deg,#d4a017,#b8860b); border-color:#8b7355; color:#111; text-shadow:none; }
.cmp-action-menu button[data-action="flush"]:not(:disabled):hover { background:linear-gradient(135deg,#f4c430,#d4a017); }

/* END TURN = Red */
.cmp-action-menu button[data-action="end"] {
  background:linear-gradient(135deg,#8b2c2c,#5c1a1a);
  border-color:#a64545;
}
.cmp-action-menu button[data-action="end"]:not(:disabled):hover { background:linear-gradient(135deg,#9d3333,#661f1f); }
.cmp-action-menu button:disabled {
  /* Preserve original background & border but visually mute */
  opacity:1; /* keep structural presence */
  filter:grayscale(.55) brightness(.82) saturate(.6);
  cursor:not-allowed;
  position:relative;
  box-shadow:2px 2px 0 #000,0 0 0 2px #222 inset;
}
/* Subtle hatch overlay for disabled state (non-intrusive) */
.cmp-action-menu button:disabled::after {
  content:"";
  position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:repeating-linear-gradient(135deg, rgba(255,255,255,0.08) 0 6px, rgba(0,0,0,0.08) 6px 12px);
  mix-blend-mode:overlay; opacity:.35;
}
.cmp-action-menu button:not(:disabled):active { transform:translate(0,0); }
.cmp-action-menu button:focus-visible { outline:3px solid #fff; outline-offset:2px; }
.cmp-action-menu[data-draggable="true"] { cursor:move; }
.cmp-action-menu.cpu-rolling { filter:grayscale(1); transform:scale(.95); transition:filter .3s ease, transform .3s ease, opacity .3s ease; }

/* CPU turn: show buttons visually muted but preserve color identity */
.cmp-action-menu.cpu-turn button { opacity:.55; filter:saturate(.6) brightness(.9); cursor:not-allowed; }
.cmp-action-menu.cpu-turn button:disabled { background:var(--btn-bg); color:#222; }
.cmp-action-menu.cpu-turn button[data-action="keep"],
.cmp-action-menu.cpu-turn button[data-action="end"] { background:var(--btn-bg-alt); }
/* Prevent hover/active transforms during CPU turn */
.cmp-action-menu.cpu-turn button:not(:disabled):hover,
.cmp-action-menu.cpu-turn button:not(:disabled):active { transform:none; box-shadow:none; filter:saturate(.6) brightness(.9); }

/* Paused game: show buttons even more muted than CPU turn */
.cmp-action-menu.is-paused { opacity: 0.4; filter: grayscale(0.8) brightness(0.7); }
.cmp-action-menu.is-paused button { cursor: not-allowed; }
.cmp-action-menu.is-paused button:not([data-action="power-cards"]):not([data-action="show-my-cards"]):hover,
.cmp-action-menu.is-paused button:not([data-action="power-cards"]):not([data-action="show-my-cards"]):active { 
  transform: none; 
  box-shadow: none; 
  filter: none; 
}

/* Flash indicator when CPU performs an action */
.cmp-action-menu button.cpu-flash { animation:cpu-flash-border 1.1s ease; }
@keyframes cpu-flash-border { 0% { box-shadow:0 0 0 0 #fff; } 25% { box-shadow:0 0 8px 3px #fff; } 55% { box-shadow:0 0 10px 4px rgba(255,255,255,.85); } 100% { box-shadow:none; } }

/* Restore borders/shadows for non-black text variants (keep/end) */
/* Hover shadow lift for enabled buttons */
.cmp-action-menu button:not(:disabled):hover { box-shadow:5px 5px 0 #000,0 0 0 2px #222 inset; }
.cmp-action-menu button:not(:disabled):active { box-shadow:2px 2px 0 #000,0 0 0 2px #222 inset; }

/* --- Mobile/touch layout: menu is fully hidden until opened (no slide animation) --- */
@media (max-width: 760px) {
  /* Force-hide actions label in mobile regardless of earlier flex display */
  .cmp-action-menu .am-label { display:none !important; width:0 !important; height:0 !important; overflow:hidden !important; padding:0 !important; margin:0 !important; }
  /* Mobile: anchor from bottom corners and expand upward, consistent width and full-width buttons */
  .cmp-action-menu {
    position: fixed;
    top: auto; left: auto; right: 16px; /* Align right edge with some padding from screen edge */
    /* bottom is computed dynamically from the triggering button via JS */
    width: max-content;
    max-width: calc(100vw - 80px); /* Leave room for action menu button and padding */
    /* removed min-width to allow natural shrink */
  flex-direction: column;
    align-items: stretch;
    justify-content: flex-start;
    gap: 6px; /* tighter vertical rhythm */
    /* Fully hidden by default on mobile; becomes visible only when opened */
    display: none;
  transform: none;
    transition: none;
    max-height: calc(55vh); /* allow more vertical space savings */
    overflow-y: auto; /* internal scroll instead of pushing layout */
    overscroll-behavior: contain;
  }
  .cmp-action-menu::-webkit-scrollbar { width:0; height:0; }
  /* Hide label on mobile */
  .cmp-action-menu .am-label { display:none; }
  /* Hide collapse toggle on mobile since mobile has its own hamburger menu system */
  .cmp-action-menu .am-collapse-toggle { display:none; }
  /* Reset content collapse on mobile */
  .cmp-action-menu .am-content {
    max-height: none !important;
    opacity: 1 !important;
    overflow: visible !important;
  }
    /* Make buttons look like Tools menu entries on mobile: flat light buttons */
    .cmp-action-menu button { 
      --am-mobile-scale: .70; /* stronger shrink so change is unmistakable */
      background:#e6e6e6 !important; 
      color:#fff !important; 
      border:none !important; 
      box-shadow:none !important; 
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000 !important;
      font-size: calc(18px * var(--am-mobile-scale)) !important; 
      line-height:1.05 !important; 
      padding: 4px 10px 6px !important; 
      min-height: 34px !important; 
      letter-spacing:.5px !important;
      width:auto !important;
    }
    .cmp-action-menu button[data-action="keep"],
    .cmp-action-menu button[data-action="end"],
    .cmp-action-menu button[data-action="flush"] { 
      background:#e6e6e6 !important; 
      color:#fff !important; 
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000 !important;
      border:none !important; 
      box-shadow:none !important; 
      font-size: calc(16px * var(--am-mobile-scale)) !important;
      min-height: 34px !important;
    }
    .cmp-action-menu button[data-action="flush"] { min-height:32px !important; font-size: calc(15px * var(--am-mobile-scale)) !important; }
  .cmp-action-menu[data-hamburger-corner="left"] { left: 8px; right: auto; }
  .cmp-action-menu[data-hamburger-open] { display:flex; }
  .cmp-action-menu .am-label { display:none; }
  /* Auto-size to longest item; keep a reasonable min-width */
  .cmp-action-menu { width: max-content; max-width: calc(100vw - 16px); padding:10px 10px 12px; }
  .cmp-action-menu button { width: auto; flex: 0 0 auto; min-width: 0; }
  .cmp-action-menu[data-draggable="true"] { cursor: default; }
  /* Tighten vertical spacing further when scroll engaged */
  .cmp-action-menu button + button { margin-top:2px; }
  /* Ensure expanded action menu content has a consistent min width on mobile */
  .cmp-action-menu .am-content[data-collapsed="false"] { min-width:480px; }
  /* Power cards submenu adjustments for cramped space */
  .power-cards-submenu { 
    padding:6px; 
    gap:4px; 
    min-width:150px; 
    transform-origin: top left; 
  }
  .power-cards-submenu button { 
    font-size:12px; 
    padding:4px 8px; 
    min-height:28px; 
  }
}

/* Invisible backdrop to allow outside-click closing on mobile when menu is open */
@media (max-width: 760px) {
  .action-menu-backdrop { position: fixed; inset: 0; z-index: 5995; display:none; }
  .action-menu-backdrop[data-show] { display:block; }
}
